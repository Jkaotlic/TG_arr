# TG_arr - Предложения по улучшению

## Критические исправления (из анализа кода)

### Высокий приоритет
- [ ] Исправить race condition в downloads handler (закрытие клиента до завершения вложенных async вызовов)
- [ ] Добавить connection pooling для HTTP клиентов (переиспользование подключений)
- [ ] Вынести дублирующийся код очистки клиентов в helper функцию
- [ ] Добавить валидацию длины поискового запроса (защита от DoS)
- [ ] Добавить rate limiting для API вызовов

### Средний приоритет
- [ ] Унифицировать язык сообщений об ошибках (всё на русском для пользователя)
- [ ] Добавить User-Agent header в HTTP запросы
- [ ] Сделать timeout конфигурируемым для qBittorrent и Emby
- [ ] Оптимизировать downloads handler - убрать двойные запросы торрентов
- [ ] Перенести импорты `time` и `timedelta` на уровень модуля

---

## Новые функции

### UX улучшения

#### Избранное / Закладки
- [ ] Добавление фильмов/сериалов в избранное
- [ ] Быстрый доступ к избранному через кнопку в меню
- [ ] Уведомления когда избранный контент становится доступен

#### История и рекомендации
- [ ] История поиска с возможностью быстрого повтора
- [ ] Рекомендации на основе скачанного контента
- [ ] "Похожие фильмы/сериалы" при просмотре деталей

#### Улучшенная навигация
- [ ] Inline режим для быстрого поиска (@bot_name query)
- [ ] Глубокие ссылки для шаринга (t.me/bot?start=movie_12345)
- [ ] Breadcrumbs навигация (где я нахожусь)

### Календарь и расписание

#### Календарь релизов
- [ ] Показ предстоящих релизов из Sonarr/Radarr
- [ ] Фильтрация по типу (фильмы/сериалы)
- [ ] Подписка на уведомления о выходе серий
- [ ] Интеграция с Google/Apple календарём

#### Расписание загрузок
- [ ] Настройка лимитов скорости по времени суток
- [ ] Приоритеты загрузки по типу контента
- [ ] Пауза всех загрузок по расписанию

### Мониторинг и статистика

#### Dashboard
- [ ] Общая статистика: скачано за день/неделю/месяц
- [ ] Топ скачанного контента
- [ ] График использования трафика
- [ ] Состояние дискового пространства на всех путях

#### Health Monitoring
- [ ] Автоматическая проверка доступности сервисов
- [ ] Уведомления при падении сервиса
- [ ] История аптайма
- [ ] Метрики производительности (время отклика API)

### Автоматизация

#### Умный выбор релизов
- [ ] Автоматический выбор лучшего релиза по scoring
- [ ] Предпочтения по релиз-группам
- [ ] Blacklist/whitelist для индексеров
- [ ] Автозамена на лучшее качество при появлении

#### Пост-обработка
- [ ] Автоудаление торрентов после завершения сидирования
- [ ] Автоматическое сканирование Emby/Plex при завершении
- [ ] Уведомление в групповой чат о новом контенте
- [ ] Webhooks для интеграции с другими сервисами

#### Умные уведомления
- [ ] Настройка типов уведомлений (только ошибки, всё, ничего)
- [ ] Группировка уведомлений (не спамить каждой серией)
- [ ] Тихие часы (не беспокоить ночью)
- [ ] Уведомления в отдельный чат/канал

### Интеграции

#### Медиа-серверы
- [ ] Jellyfin интеграция (аналог Emby)
- [ ] Plex интеграция
- [ ] Kodi интеграция

#### Запросы контента
- [ ] Overseerr/Ombi интеграция
- [ ] Петициа/Jelllyseerr поддержка
- [ ] Публичные запросы от пользователей

#### Внешние списки
- [ ] Trakt.tv синхронизация watchlist
- [ ] IMDb списки импорт
- [ ] Letterboxd интеграция
- [ ] TMDb/TVDb коллекции
- [ ] RSS фиды для автодобавления

#### Торрент-клиенты
- [ ] Transmission поддержка
- [ ] Deluge поддержка
- [ ] rTorrent поддержка

### Администрирование

#### Управление пользователями
- [ ] Добавление/удаление пользователей через бота
- [ ] Роли и права (admin, user, readonly)
- [ ] Квоты на скачивание
- [ ] Лимиты запросов в день

#### Аудит и логи
- [ ] Детальная история действий каждого пользователя
- [ ] Экспорт логов
- [ ] Алерты на подозрительную активность

#### Бэкап и восстановление
- [ ] Экспорт настроек пользователей
- [ ] Импорт конфигурации
- [ ] Автоматический бэкап БД

### Telegram-специфичные

#### Mini App (Web App)
- [ ] Полноценный веб-интерфейс внутри Telegram
- [ ] Удобный поиск с фильтрами
- [ ] Карточки контента с постерами
- [ ] Drag-n-drop приоритеты

#### Групповые функции
- [ ] Бот в групповом чате с общими уведомлениями
- [ ] Голосование за контент
- [ ] Совместные списки "хотим посмотреть"

#### Улучшенный UI
- [ ] Постеры в сообщениях (когда возможно)
- [ ] Красивое форматирование с эмодзи
- [ ] Прогресс-бары для загрузок
- [ ] Реакции вместо кнопок для быстрых действий

---

## Технические улучшения

### Производительность
- [ ] Кэширование результатов поиска
- [ ] Кэширование профилей качества и папок
- [ ] Ленивая загрузка данных
- [ ] WebSocket для real-time обновлений

### Надежность
- [ ] Graceful shutdown с сохранением состояния
- [ ] Retry логика с exponential backoff везде
- [ ] Circuit breaker для внешних API
- [ ] Fallback на кэш при недоступности сервисов

### Разработка
- [ ] Полное покрытие тестами
- [ ] CI/CD pipeline
- [ ] Автоматическая документация API
- [ ] Контейнеризация для разных архитектур (ARM)

### Мониторинг
- [ ] Prometheus метрики
- [ ] Grafana дашборды
- [ ] Structured logging в JSON
- [ ] Sentry интеграция для ошибок

---

## Приоритеты реализации

### Фаза 1 - Стабилизация
1. Исправление критических багов из анализа
2. Rate limiting
3. Улучшенное логирование

### Фаза 2 - Core Features
1. Календарь релизов
2. Dashboard со статистикой
3. Избранное

### Фаза 3 - Интеграции
1. Jellyfin/Plex
2. Trakt.tv
3. Дополнительные торрент-клиенты

### Фаза 4 - Advanced
1. Mini App
2. Автоматизация
3. Групповые функции

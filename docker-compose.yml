services:
  tg-arr-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tg-arr-bot
    restart: unless-stopped
    environment:
      # Required
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:?Set TELEGRAM_BOT_TOKEN}
      PROWLARR_URL: ${PROWLARR_URL:?Set PROWLARR_URL}
      PROWLARR_API_KEY: ${PROWLARR_API_KEY:?Set PROWLARR_API_KEY}
      RADARR_URL: ${RADARR_URL:?Set RADARR_URL}
      RADARR_API_KEY: ${RADARR_API_KEY:?Set RADARR_API_KEY}
      SONARR_URL: ${SONARR_URL:?Set SONARR_URL}
      SONARR_API_KEY: ${SONARR_API_KEY:?Set SONARR_API_KEY}
      # Users
      ALLOWED_TG_IDS: ${ALLOWED_TG_IDS:-}
      ADMIN_TG_IDS: ${ADMIN_TG_IDS:-}
      # qBittorrent (optional)
      QBITTORRENT_URL: ${QBITTORRENT_URL:-}
      QBITTORRENT_USERNAME: ${QBITTORRENT_USERNAME:-admin}
      QBITTORRENT_PASSWORD: ${QBITTORRENT_PASSWORD:-}
      QBITTORRENT_TIMEOUT: ${QBITTORRENT_TIMEOUT:-30.0}
      # Emby (optional)
      EMBY_URL: ${EMBY_URL:-}
      EMBY_API_KEY: ${EMBY_API_KEY:-}
      EMBY_TIMEOUT: ${EMBY_TIMEOUT:-30.0}
      # TMDb (optional)
      TMDB_API_KEY: ${TMDB_API_KEY:-}
      TMDB_LANGUAGE: ${TMDB_LANGUAGE:-ru-RU}
      # Notifications
      NOTIFY_DOWNLOAD_COMPLETE: ${NOTIFY_DOWNLOAD_COMPLETE:-true}
      NOTIFY_CHECK_INTERVAL: ${NOTIFY_CHECK_INTERVAL:-60}
      # Tuning
      TIMEZONE: ${TIMEZONE:-Europe/Moscow}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      AUTO_GRAB_SCORE_THRESHOLD: ${AUTO_GRAB_SCORE_THRESHOLD:-80}
      HTTP_TIMEOUT: ${HTTP_TIMEOUT:-30.0}
      HTTP_MAX_RETRIES: ${HTTP_MAX_RETRIES:-3}
      RESULTS_PER_PAGE: ${RESULTS_PER_PAGE:-5}
    volumes:
      - bot-data:/app/data
    # Resource limits work in Swarm mode and Portainer Swarm stacks.
    # For standalone docker compose, use Portainer UI to set limits.
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'

volumes:
  bot-data:
    driver: local
